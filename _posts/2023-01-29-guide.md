---
published: true
layout: page
title: Lab Guide
---

# Contents
 - [Introduction](#introduction) 
 - [Learning Objectives](#learning-objectives) 
 - [Network Diagram](#network-diagram) 
 - [Get Started](#get-started)  
 - [Cisco Catalyst 9800 Series Wireless Controller](#cisco-catalyst-9800-series-wireless-controller)
	-	[Day 0 configuration](#day-0-configuration)
	-	[AP join](#ap-join)
	-	[Catalyst 9800 Wireless Controllers Configuration Model](#catalyst-9800-wireless-lan-controller-configuration-model)
    -   [Migrate to Meraki Management](#migrate-to-meraki-management)
	-	[Troubleshooting tools](#troubleshooting-tools)
 - [Meraki Dashboard](#meraki-dashboard) 
	-	[Modify your network information](#modify-your-network-information) 
    -   [Configuring Enterprise SSID](#configuring-enterprise-ssid) 
    -   [Configuring Guest SSID](#configuring-guest-ssid) 
    	-   [Meraki Splash page](#meraki-splash-page) 
    -   [Radio Settings](#radio-settings)
    -   [Troubleshoot Meraki AP](#troubleshoot-meraki-ap)
    -   [Migration from Meraki to 9800 WLC](#migration-from-meraki-to-9800-wlc)


## Introduction

Cisco Catalyst 9166, 9164, and 9162 Series Access Points (AP) are the first AP from Cisco that give you the flexibility to manage your wireless network on premises or in the cloud.
They provide the best of both worlds while delivering flexibility and investment protection for your network.

Cisco understands that selecting your next platform is not an easy choice. With the Cisco Catalyst Wi-Fi 6E access points, you don’t need to make the decision now. Keep the operational mode you use today, whether on premises or cloud management. If your need to change it is an easy switch. No new hardware required.

## Learning Objectives

With this LAB will walk you through the steps to migrate an AP Wi-Fi 6E from management with 9800 Wireless LAN Controller to Meraki cloud, vice versa and to demonstrate Wi-Fi 6E configuration.

## Network Diagram 

![](/images/Picture1.png)
 
## Get Started

To access your session open Anyconnect App, add your credentials and click **Connect**. 

**Host:** dcloud-rtp-anyconnect.cisco.com

_Select from the table your corresponding credentials:_

```
| **Pod**         | **User**          | **Password**  |
| --------------- |:-----------------:| -------------:|
| 1               | `v2718user1`      |    `3b48dc`   |
| 2     | `v293user1`       | `c76ca5`    |
| 3     | ``       | ``    |
| 4     | ``       | ``    |
| 5     | ``       | ``    |
| 6     | ``       | ``    |
| 7     | ``       | ``    |
| 8     | ``       | ``    |
| 9     | ``       | ``    |
| 10     | ``       | ``   |
| 11     | ``       | ``    |
| 12     | ``       | ``    |
| 13     | ``       | ``    |
| 14     | ``       | ``    |
| 15     | ``       | ``    |
```

![](/images/annyconnect1.png)

Once VPN connection is stablished open a Remote Desktop Connection

![](/images/rdp.png)

**Host:** 198.18.133.36
**User:** Administrator
**Password:** C1sco12345

## Cisco Catalyst 9800 Series Wireless Controller

The Catalyst 9800 is Cisco's latest and greatest Wireless LAN Controller, and it's a real game-changer! It can be deployed either on-premises or in a private or public cloud, giving you a lot of flexibility. The C9800 offers awesome features like telemetry, high availability, programmability, and more.

In this section, we'll start by showing you the basics of setting up a Wireless Controller and a 916X Access Point in a private cloud controller. Then, we will take things to the next level and show you how to migrate the AP management to Meraki. It's going to be a fun and informative ride, so buckle up and let's get started!

![](/images/9800-networkdiagram_2.png)

### Day 0 configuration

Setting up your Wireless Controller is a breeze! Just follow the instructions and you will be up and running in no time. Keep in mind that the day0 configuration is only necessary for brand new installations or when the Controller's configuration has been reset to factory defaults. You have the option to use either the Web UI or CLI procedure for this exercise, so pick the one that you feel most comfortable with. 

click here to move to the [Web UI Procedure](####web-ui-procedure)

#### CLI Procedure

1.Access to Controller via SSH.

In the remote desktop access the Controller CLI via SSH using mRemoteNG App. Once there go to connections and click on **C9800**. 

Login with the following credentials:

- **Username:** dcloud 
- **Password:** dcloud 
- **Enable:** dcloud

![](/images/mremoteng-ssh.png)

2.Set the hostname as seen below:

```
WLC#conf t
WLC(config)#hostname C9800
```

3.Configure vlan 10 for the wireless management.

```
C9800#conf t
C9800(config)#vlan 10
C9800(config-vlan)#name wireless_management
```
	
4.Configure the SVI for Wireless Management Interface (WMI) as follows:

```
C9800(config)#int vlan 10
C9800(config-if)#ip address 198.19.10.7 255.255.255.0
C9800(config-if)#no shutdown
```

5.Configure the GigabitEthernet 2 as trunk and allow Vlan 10:

```
C9800(config-if)#interface GigabitEthernet2   
C9800(config-if)#switchport mode trunk
C9800(config-if)#switchport trunk allowed vlan 10
C9800(config-if)#shut
C9800(config-if)#no shut
```

6.Configure the WMI default route:

```
C9800(config-if)#ip route 0.0.0.0 0.0.0.0 198.19.10.254
```

7.Disable the wireless network to configure the country code:

```
C9800(config)#ap dot11 5ghz shutdown 
Disabling the 802.11a network may strand mesh APs.
Are you sure you want to continue? (y/n)[y]: y
C9800(config)#ap dot11 24ghz shutdown 
Disabling the 802.11b network may strand mesh APs.
Are you sure you want to continue? (y/n)[y]: y
C9800(config)#ap dot11 6ghz shutdown
Disabling the 802.11 6GHz network may strand mesh APs.
Are you sure you want to continue? (y/n)[y]: y
```

8.Configure the AP country domain. This configuration is what will trigger the GUI to skip the DAY 0 flow as the C9800 needs a country code to be operational:

```
C9800(config)#wireless country BE
C9800(config)#wireless country MX
C9800(config)#wireless country US
C9800(config)#wireless country CA

```

9.Enable the 802.11a and 802.11b/g networks

```
C9800(config)# no ap dot11 24ghz shutdown
C9800(config)# no ap dot11 5ghz shutdown
C9800(config)# no ap dot11 6ghz shutdown
```

10.Specify the interface, in this case Vlan 10, to be the Wireless Management Interface.


```
C9800(config)# wireless management interface Vlan10
C9800(config-mgmt-interface)#end
```

11.A certificate is needed for the AP to join the virtual C9800. This can be created automatically using the following commands.

```
C9800#wireless config vwlc-ssc key-size 2048 signature-algo sha256 password 0 Cisco123
Configuring vWLC-SSC…
Script is completed
```

This is a script that automates the whole certificate creation.


12.Verify Certificate Installation:

```
C9800#show wireless management trustpoint
Trustpoint Name  : C9800_WLC_TP
Certificate Info : Available
Certificate Type : SSC
Certificate Hash : 31ee336150e5e2b2ee1f8e554c20dabac6ecd6af
Private key Info : Available
FIPS suitability : Not Applicable
```

13.Access via GUI. In your remote desktop open a browser and type **https://100.64.0.7** or click on the **C9800-CL** bookmark.

- **Username:** dcloud 
- **Password:** dcloud 

![](/images/GUI-credentials.png)

You have finished the initial configuration. 

#### Web UI Procedure

1.Access the Day 0 Wizard via Out-Of-Band port. 
In the remote desktop open a Google Chrome and type **https://100.64.0.7** or click on the **C9800-CL** bookmark. Use following credentials.

- **Username:** dcloud 
- **Password:** dcloud

![](/images/GUI-credentials.png)

2.Once you are logged into the Controller, fill in the following:

In the General Settings screen, 

- Deployment mode – Standalone
- Country Code - US,MX,BE,CA
- NTP Server - 100.64.0.1

![](/images/Day0_1.png)

• Wireless Management Settings

- Port number - GigabitEthernet2
- IPv4 - Check
- Wireless Management VLAN - 10
- Wireless Management IP - 198.19.10.7
- Subnet mask - 255.255.255.0
  
• Static Route Settings

- IPv4 Route - Check 
- IPv4 Destination Prefix - 0.0.0.0	
- IPv4 Destination Mask - 0.0.0.0 
- IPv4 Next Hop IP - 198.19.10.254
- Click **Next**

![](/images/Day0_2.png)

In the Wireles Network Settings click  **+Add**,

• Add Network

- Network Name - CiscoLive
- Network Tye - Employee
- Security - WPA2 Personal
- Pre-Shared Key - Cisco123
- Click **+Add** and **Next**

![](/images/Day0_3.png)

In the Advanced Settings

• AP Certificate

- Generate Certificate - Yes
- RSA Key-Size - 2048
- Signature Algorithm - sha256
- Password - C1sco12345
  
• Create a New AP Management User

- New AP Management User - admin
- Password - C1sco12345
- Secret - C1sco12345
- Click "Summary"

![](/images/Day0_4.png)

![](/images/Day0_5.png)

3.Review the Summary, If all settings are correct click "Finish" and proceed as shown in the images below. 

![](/images/Day0_6.png)

![](/images/Day0_6_1.png)

4.After a minute or two refresh the page and log in with same credentials. Now you will be prompted with the Wireless Controller GUI. 


### AP join

For this lab configure the WLC Public IP address so the APs can reach the Controller through the internet. 

```
| **Pod**         | **Public IP**     |
| ------------- |:-------------:|
| 1     | `64.100.10.X`       |
| 2     | `64.100.10.X`       |
| 3     | `64.100.10.X`       | 
| 4     | `64.100.10.X`       |
| 5     | `64.100.10.X`       |
| 6     | `64.100.10.X`       | 
| 7     | `64.100.10.X`       | 
| 8     | `64.100.10.X`       | 
| 9     | `64.100.10.X`       | 
| 10     | `64.100.10.X`       | 
| 11     | `64.100.10.X`       | 
| 12     | `64.100.10.X`       | 
| 13     | `64.100.10.X`       |
| 14     | `64.100.10.X`       |
| 15     | `64.100.10.X`       |
```

Select your corresponding Public IP address from above table, then navitage to **Configuration > Interface > Wireless**, click on the Management interface and add the public IP address to the "NAT IPv4" field as in below image, then hit "**Update & Apply to Device**".

![](/images/wmi-nat.png)

Once the Public IP is configured you will see your assigned Access Point joining to your brand new 9800 Controller.

Verify your AP joined using "**show ap summary**" command. 

```
C9800#show ap summary 
Number of APs: 1

CC = Country Code
RD = Regulatory Domain

AP Name                          Slots AP Model             Ethernet MAC   Radio MAC      CC   RD   IP Address                                State        Location
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
CW9166I-A-6                      3     CW9166I-A            cc9c.3ef7.e440 6c8d.772e.63a0 MX   -A   172.16.26.189                             Registered   default location    
```

This step can take a couple of minutes. Check back in few minutes. 



-----------------

!!! IMPORTANT !!!

Plase take a moment to send us an email to: rafenriq@cisco.com
So we can set up your meraki access in the LAB account. 
This mail is the one you will use to validate your account and set up your password 

-----------------


The 9800 Wireless Controller uses tags to control the features available for each Access Point. These tags are assigned to the Access Points as part of the rule engine that runs on the Controller. The rule engine comes into effect during the AP join process and ensures that the correct features are enabled for each Access Point. It's a simple but powerful system that helps you stay in control of your wireless network.

Verify what tags where applied to the access point. Use "**show ap tag summary**" command. 

```
C9800#show ap tag summary 
Number of APs: 1

AP Name                           AP Mac           Site Tag Name                     Policy Tag Name                   RF Tag Name                       Misconfigured    Tag Source    
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CW9166I-A-6                       cc9c.3ef7.e440   default-site-tag                  default-policy-tag                default-rf-tag                    No               Default       
```

Observe that when a brand new Access Point joins, the Controller assings the default tags. 


If you prefer GUI, you can verify if AP is joined from "**Configuration > Wireless > Access Points >**"

![](/images/AP_joined.png)

To check the current tags click on the AP entry and look at the "Tags" section in the "General" tab. Observe that when a brand new Access Point joins, the Controller assings the default tags. 

![](/images/AP_tags_default.png) 

Now that you confirmed the AP has joined navigate to **Monitoring > Wireless > AP statistics** click on the wrench icon for both the AP Radio and Ethernet MAC. 

![](/images/ratrace_1.png)

Select "here" as shown below, when you select the second mac address. 

![](/images/ratrace_2.png)

Start Conditional Debug Global State. We will use this tool later.

![](/images/ratrace_3.png)

### Catalyst 9800 Wireless LAN Controller Configuration Model

The Catalyst 9800 configuration model was created with simplicity, flexibility, and reusability in mind. It makes use of Profiles contained within Tags, which are then applied to the Access Points. This approach makes it easy to manage and customize your wireless network.

There are three types of tags:

- **Policy Tag:** This tag links a WLAN Profile (SSID) to a Policy Profile.
- **Site Tag:** This tag defines the AP mode and other AP settings through the AP join profile and Flex profile.
- **RF Tag:** This tag sets the RF profiles with the settings for each band.

Each of these tags plays a specific role in the configuration model, and together they provide a comprehensive and easy-to-use system for managing your wireless network.

![](/images/config model.png)

Let's create customized Profiles and Tags, later we will apply these tags to the Access Point joined to your Controller.

1. Access the Controller GUI with your credentials.

- **GUI:** https://100.64.0.7
- **Username:** dcloud
- **Password:** dcloud

2.Create a new SSID. 

Navigate to **Configuration > Tags & Profiles > WLAN > +Add**

![](/images/wlanprofile_add.png)

WLAN creation window will pop up, give it a name and enable it.

![](/images/PSK_SAE_0.png)

Navigate to the **Security tab > Layer2**. To create a Pre-Shared Key SSID set configurations as in the image below, then hit **Apply to Device**.

![](/images/PSK_SAE_1.png)

![](/images/PSK_SAE_2.png)

This is how your new WLAN looks like.

![](/images/PSK_SAE_3.png)

3.Create a new Policy Profile. 

Navigate to **Configuration > Tags & Profiles > Policy > +Add**

![](/images/Policyprofile_add.png)

Give it a name and enable it, make sure that under **WLAN switching policy** only **Central authentication** is enabled,  then hit **Apply to Device**.

![](/images/Policyprofile_general.png)

Navigate to the **Access Policies** tab. Here you can define the Vlan name or Vlan ID for the SSID, in this case we will use the Vlan name "Clients" that will be later defined in the Flex Profile.

![](/images/Policyprofile_access.png)

This is how your Policy Profile looks like.

![](/images/PolicyProfile.png)

4.Create the Policy tag and map the created WLAN and Policy Profiles.

Navigate to **Configuration > Tags & Profiles > Tags > Policy > +Add**

![](/images/tag_policy_AMS.png)

5.Create an AP join Profile. Configure the name and the corresponding Country. Follow the table below to verify the country you need to configure for your given AP.

Navigate to **Configuration > Tags & Profiles > AP join > +Add**

![](/images/ap_join_country.png)

```
| POD           | PID         | Country  |
| ------------- | ----------- | ---------|
| 1             | CW9166I-A   | CA       |
| 2             | CW9164I-A   | CA       |
| 3             | CW9166I-A   | CA       |
| 4             | CW9166I-A   | CA       |
| 5             | CW9164I-A   | CA       |
| 6             | CW9166I-A   | CA       |
| 7             | CW9166I-A   | CA       |
| 8             | CW9164I-A   | CA       |
| 9             | CW9164I-A   | CA       |
| 10            | CW9162I-B   | US       |
| 11            | CW9162I-B   | US       |
| 12            | CW9164I-A   | CA       |
| 13            | CW9166I-B   | US       |
| 14            | CW9166I-B   | US       |
| 15            | CW9166I-B   | US       |
```
<!--  To validate a Product ID for a country refer [Wireless LAN Compliance Lookup](https://www.cisco.com/c/dam/assets/prod/wireless/wireless-compliance-tool/index.html). 
![](/images/country-code.png)-->

6.Create a Flex Profile. 

Navigate to **Configuration > Tags & Profiles > Flex > +Add**. Give it a name and define the AP native vlan, in this case we will use Vlan ID 30 (which is the VLAN where AP sits on). This is the same value as the native vlan configured in the AP switchport.

![](/images/FlexProfile_add_General.png)

Select the VLAN tab, click **+Add** and set configurations as in the image below. This is the VLAN that wireless client will use when connecting to the just defined SSID. 

![](/images/FlexProfile_vlan.png) 

7.Create a new Site tag and apply the created AP join and Flex Profiles.

Navigate to **Configuration > Tags & Profiles > Tags > Site > +Add**

Uncheck "Enable Local Site" and set configurations as in the image below.

![](/images/tag_site_AMS.png)


8.In this lab we will not create the RF tag and their corresponding RF profiles. You can use the default-rf-tag.


9.AP tag assignation can be done in multiple ways. We will review both of them, per AP and multiple APs at once.

#### Assigning tags to a specific AP.

Navigate to **Configuration > Wireless > Access Points** and select the Access Point then the "Edit AP" window will appear. In the "Tags" section of the "General" tab select from the drop-down list the tags you created in previous steps.

![](/images/APtagging_1.png)

![](/images/APtagging_2.png)

_Note: Changing AP Tag(s) will cause associated AP(s) to rejoin and disrupt connected client(s).
It can take a couple of minutes for the AP to rejoin_


#### Assigning tags to multiple APs.

Navigate to **Configuration > Wireless Setup > Advanced > Start Now** then click on the List icon as shown below. 

![](/images/APtagging_3.png)
![](/images/APtagging_4.png)

Check the Access Points to be tagged, then select **+Tag APs** and a small window will pop up, there select the tags that you want to assign to the APs and click **Apply to Device**.

![](/images/APtagging_5.png)

For this lab you have one assigned Access Point, yet consider in production environments you can select them and apply the tags at once.

_Note: Changing AP Tag(s) will cause associated AP(s) to rejoin and disrupt connected client(s).
It can take a couple of minutes for the AP to rejoin._

Verify what tags where applied to the access point. Use "**show ap tag summary**" command. 

```
C9800#show ap tag summary 
Number of APs: 1

AP Name                           AP Mac           Site Tag Name                     Policy Tag Name                   RF Tag Name                       Misconfigured    Tag Source    
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CW9166I-A-6                       cc9c.3ef7.e440   Site_AMS                  PT_AMS               default-rf-tag                    No               Default       
```


### Migrate to Meraki Management

The change of Enterprise Access Points to Meraki Persona can be triggered from the Wireles LAN Controller only after the AP has successfully joined to the WLC. 

**Requirements for the conversion:**

- C9800 WLC running 17.9 or higher
- Access Points joined to the C9800 WLC
- Correct Country Code must be configured according to physical location.
- Access Points management vlan must have DHCP server, DNS resolution and have reachability to Meraki Cloud. 

Permit common protocols (HTTP, HTTPS, DNS and ICMP) to "any" internet address to allow the connectivity tests to function correctly. Refer [Upstream Firewall Rules for Cloud Connectivity] (https://documentation.meraki.com/General_Administration/Other_Topics/Upstream_Firewall_Rules_for_Cloud_Connectivity#Addresses_and_Ports_to_Allow) to have more information on what ports, protocols are needed.

**Verify configured country codes**

Review the list of available country codes configured on your device.

```
C9800#show wireless country configured

Configured Country................ Multiple Countries : BE,MX,US
Configured Country Codes
        BE  - Belgium                   802.11a Indoor,Outdoor/ 802.11b Indoor,Outdoor/ 802.11g Indoor,Outdoor/ 802.11 6GHz Indoor
        MX  - Mexico                    802.11a Indoor,Outdoor/ 802.11b Indoor,Outdoor/ 802.11g Indoor,Outdoor/
        US  - United States             802.11a Indoor,Outdoor/ 802.11b Indoor,Outdoor/ 802.11g Indoor,Outdoor/ 802.11 6GHz Indoor

```

To validate a Product ID for a country refer to [Wireless LAN Compliance Lookup](https://www.cisco.com/c/dam/assets/prod/wireless/wireless-compliance-tool/index.html).

![](/images/country-code.png)


**Verify Meraki Capable Access Points**

Not all AP models are Meraki Capable. To verify this capability issue the "**show ap management-mode meraki capability summary**" command.

```      
C9800#show ap management-mode meraki capability summary
AP Name                          AP Model             Radio MAC        MAC Address      AP Serial Number       Meraki Serial Number
-----------------------------------------------------------------------------------------------------------------------------------
CW9166I-A-6                      CW9166I-A            6c8d.772e.63a0   cc9c.3ef7.e440   KWC26330BTF            Q5AF-9VQV-3Q2B

```
To see the list of Meraki Capable APs from GUI navigate to **Configuration > Wireless > Migrate to Meraki Management Mode** 

![](/images/migrate-to-meraki-gui-0.png)


**Change AP management-mode to Meraki**

The conversion can be triggered per Access Point or to multiple Access Points at once. Chose whatever method you feel more confortable with. 

_Per AP basis_

Conversion per AP is only possible via WLC CLI. Use the "**ap name \<ap-name\> persona meraki**" command. 

```
C9800#ap name CW9166I-A-6 persona meraki
Executing this command will cause AP to reboot and it will no longer be manageable from this Wireless LAN Controller. Are you sure you want to continue?(y/n)[y][confirm]y
 ```

_To multiple APs_

Single or batch conversion can be triggered from WLC GUI.

1.Navigate to **Configuration > Wireless > Migrate to Meraki Management Mode** and select the APs to migrate, then click on **Migrate to Meraki Management Mode**

![](/images/migrate-to-meraki-gui-1.png)

2.Validate the country code check is green, and regulatory domains for Slot 0 and Slot 1 are green too. It is possible that Slot 2 correspondig to 6GHz is red due to country configured is not supported in current version, however the conversion can be triggered. Click **Next**.
  
![](/images/migrate-to-meraki-gui-2.png)

3.Confirm Management Mode Migration. Select **Agree and continue** followed by **Yes**.
  
![](/images/migrate-to-meraki-gui-3.png)

This will cause the selected APs to reboot and they will no longer be manageable from this Wireless LAN Controller.

4.Once conversion took place you will see the Access Points in the "**Management Mode Migration Successful**" list.

![](/images/migrate-to-meraki-gui-4.png)

**Verify migrated Access Points**

Management Modes migrated in the past can be visualized in the **Configuration > Wireless > Migrate to Meraki Management Mode > Previously migrated APs** tab.

![](/images/migrate-to-meraki-gui-5.png)

The equivalent output on CLI is the "**show ap management-mode meraki change summary**" command.

```
C9800#show ap management-mode meraki change summary
Note: This CLI prints successful Meraki management-mode change attempts of all APs


AP Name                             AP Model              Radio MAC        MAC Address      Conversion Timestamp       AP Serial Number        Meraki Serial Number
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
CW9166I-A-6                         CW9166I-A             6c8d.772e.63a0   cc9c.3ef7.e440   01/15/2023 04:45:05 UTC    KWC26330BTF             Q5AF-9VQV-3Q2B
```

```
C9800#show logging  last 5
 . . .
Showing last 5 lines
Log Buffer (131072 bytes):
Jan 15 04:39:20.232: %IOSXE_RP_CFG_NOT-6-IOX_SERVICE_NOTSUPPORTED: IOx service not supported.
Jan 15 04:39:20.857: %SYS-5-CONFIG_P: Configured programmatically by process SEP_webui_wsma_http from console as dcloud on vty1
Jan 15 04:45:05.217: %APMGR_TRACE_MESSAGE-6-AP_MERAKI_CONVERSION_SUCCESS: Chassis 1 R0/0: wncd: AP CW9166I-A-6, MAC 6c8d.772e.63a0, Meraki serial number: Q5AF-9VQV-3Q2B, Meraki persona change result: Success.Terminating the CAPWAP session.
Jan 15 04:45:31.086: %CAPWAPAC_SMGR_TRACE_MESSAGE-5-AP_JOIN_DISJOIN: Chassis 1 R0/0: wncd: AP Event: AP Name: CW9166I-A-6 Mac: 6c8d.772e.63a0 Session-IP: 64.100.12.17[5272] 198.19.10.7[5246] Disjoined AP persona
```

Review if there are failed convertions, issue the "**show ap management-mode meraki failure summary**" command from CLI.

```
C9800#show ap management-mode meraki failure summary
```

Now your APs should be rebooting and booting using the Meraki software. In the next section, you will claim the recently converted AP. Note that in order to claim the Access Points, you must have the appropriate licenses, such as co-termination or per-device licensing models.

Please refer to [Meraki Per-Device Licensing Overview](https://documentation.meraki.com/General_Administration/Licensing/Meraki_Per-Device_Licensing_Overview) to learn more about the PDL model.

Please refer to [Meraki Co-Termination Licensing Overview](https://documentation.meraki.com/General_Administration/Licensing/Meraki_Co-Termination_Licensing_Overview) to learn more about the co-term model.


### Troubleshooting tools

Troubleshooting tools in the 9800 are quite poweful. To know in detail about the 9800 troubleshooting tools we encourage you to assist the "_Troubleshoot Catalyst 9800 Wireless Controllers - BRKEWN-3628_" (taking place Friday 9:00 am). During this section we will cover an overview of the most used tools. 

**Syslog**

This presents the logs generated by the 9800 WLC, this output shows general logs as well as some wireless-specifics logs. 

Verify that AP was succesfully converted from controller syslog. Look for the log "**Meraki persona change result: Success.Terminating the CAPWAP session.**" followed by the AP disjoin log.

You can find them at **Troubleshooting > Logs**
 
![](/images/syslog.png)

Or from CLI:

```
C9800#show logging
....

Log Buffer (131072 bytes):

Jan 18 03:13:59.132: %SYS-5-CONFIG_P: Configured programmatically by process SEP_webui_wsma_http from console as dcloud on vty1
Jan 18 03:13:59.263: %IOSXE_RP_CFG_NOT-6-IOX_SERVICE_NOTSUPPORTED: IOx service not supported.
Jan 18 03:13:59.892: %SYS-5-CONFIG_P: Configured programmatically by process SEP_webui_wsma_http from console as dcloud on vty1
Jan 18 03:23:49.019: %APMGR_TRACE_MESSAGE-6-AP_MERAKI_CONVERSION_SUCCESS: Chassis 1 R0/0: wncd: AP APCC9C.3EF7.E440, MAC 6c8d.772e.63a0, Meraki serial number: Q5AF-9VQV-3Q2B, Meraki persona change result: Success.Terminating the CAPWAP session.
Jan 18 03:24:13.801: %CAPWAPAC_SMGR_TRACE_MESSAGE-5-AP_JOIN_DISJOIN: Chassis 1 R0/0: wncd: AP Event: AP Name: APCC9C.3EF7.E440 Mac: 6c8d.772e.63a0 Session-IP: 64.100.12.17[5272] 198.19.10.7[5246] Disjoined AP persona change to Meraki
C9800#

```

**RadioActive tracing**

RadioActive traces give the ability to conditionally print debug information across processes and threads using a condition of interest. 

Navigate to **Troubleshooting > Radioactive Trace** . You will find the RadioActive trace we enabled before filtered by Radio and Ethernet MAC. Select one of them and click "Generate", generate logs for last 30 minutes and "Apply to Device"

![](/images/ratrace_4.png)

Download the log file (use either of the download icons). 

![](/images/ratrace_5.png)

<!--The most used case is when troubleshooting client connectivity,here the conditional debug runs for client mac or ip address to get end to end view at control plane.

add images

Later you can upload the RadioActive traces into the [Wireless Debug Analyzer]https://cway.cisco.com/wireless-debug-analyzer/), this tool parsed debug files to make easier to troubleshoot wireless issues such as client association, authentication, roaming, and connectivity issues. -->


Open the file and you will see the logs about AP Conversion Success:

```
2023/01/18 03:23:49.018866255 {wncd_x_R0-0}{1}: [apmgr-db] [15668]: (note): MAC: 6c8d.772e.63a0  Ack received for Meraki request payload
2023/01/18 03:23:49.019260232 {wncd_x_R0-0}{1}: [errmsg] [15668]: (info): %APMGR_TRACE_MESSAGE-6-AP_MERAKI_CONVERSION_SUCCESS: R0/0: wncd: AP APCC9C.3EF7.E440, MAC 6c8d.772e.63a0, Meraki serial number: Q5AF-9VQV-3Q2B, Meraki persona change result: Success.Terminating the CAPWAP session.
2023/01/18 03:23:49.019382056 {wncd_x_R0-0}{1}: [ap-join-info-db] [15668]: (note): MAC: 6c8d.772e.63a0  AP disconnect initiated. Reason: AP persona change to Meraki, Phase: Run
...
2023/01/18 03:24:13.808512436 {wncd_x_R0-0}{1}: [apmgr-ap-global] [15668]: (note): MAC: 6c8d.772e.63a0  AP SM Purge. AP deregister complete
```

In case of failure these logs will be helpful to know the reason of failure.

**Always-On-Tracing**

These are the Notice logging level traces on the C9800. This tool allows to get contextual data on a failure that has occurred without mandating the failure condition to be reproduced. To troubleshoot Access Point issues its recommended to filter by AP radio MAC address. Grab the AP MAC address from "show ap summary" command, then collect the Aways On Traces.

-One day Always on traces filtered by MAC
    
Use the "**show ap summary**" command to grab the AP Radio Mac. 

```
C9800#show ap summary
Number of APs: 1

CC = Country Code
RD = Regulatory Domain

AP Name                          Slots AP Model             Ethernet MAC   Radio MAC      CC   RD   IP Address                                State        Location
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
APCC9C.3EF7.E440                 3     CW9166I-A            cc9c.3ef7.e440 6c8d.772e.63a0 CA   -A   64.100.12.17  
```

Then use the "**show logging profile wireless start last 1 hour filter mac \<radio-mac-address\> to-file bootflash:<FILENAME.log>**" to send all logs to a file.

```
C9800#show logging profile wireless start last 1 hour filter mac 6c8d.772e.63a0 to-file bootflash:AOT_ap_conversion.log
```

To view the content use the "**more bootflash:<FILENAME.log>**" command

```
C9800#more  bootflash:AOT_ap_conversion.log | i Meraki
2023/01/18 03:23:49.018866255 {wncd_x_R0-0}{1}: [apmgr-db] [15668]: (note): MAC: 6c8d.772e.63a0  Ack received for Meraki request payload
2023/01/18 03:23:49.019260232 {wncd_x_R0-0}{1}: [errmsg] [15668]: (info): %APMGR_TRACE_MESSAGE-6-AP_MERAKI_CONVERSION_SUCCESS: R0/0: wncd: AP APCC9C.3EF7.E440, MAC 6c8d.772e.63a0, Meraki serial number: Q5AF-9VQV-3Q2B, Meraki persona change result: Success.Terminating the CAPWAP session.
2023/01/18 03:23:49.019382056 {wncd_x_R0-0}{1}: [ap-join-info-db] [15668]: (note): MAC: 6c8d.772e.63a0  AP disconnect initiated. Reason: AP persona change to Meraki, Phase: Run

```

**Useful show commands**

In case you find any failure the following commands can help to determine the AP status. Feel free to run them to get familiar with the outputs. 

```
C9800#show wireless country configured
C9800#show wireless stats ap history
C9800#show ap status
C9800#show ap management-mode meraki capability summary
C9800#show ap management-mode meraki change summary
C9800#show ap management-mode meraki failure summary
```

_____________________________________________________________________________


## Meraki Dashboard

The first thing that we need to do is to create an account in Meraki dashboard. 

**_For this LAB we have created the users under the same account, as per divices register under the same license._**

At this point you should have a mail as the following to set up your password

![](/images/merakiaccount1.png)

Pick up a password so we are ready to access the dashboard. 

![](/images/merakiaccount2.png)

_____________________________________________________________________________

_If you like, you are welcome to create your dashboard account we leave the link in the reference section._
_Meraki offers free trials so it is very to play with your our account_ 

_____________________________________________________________________________

You can open the following [link](https://account.meraki.com/secure/login/dashboard_login) to access your account, with your  credentials. 

Once you log in to the Dashboard you will see the following page: 

![](/images/dashboard.png)

Next step is, we need to create your own network,for that, follow the next screen shoots: 

![](/images/createnetwork1.png)

Enter a name for your network

![](/images/createnetwork2.png)

To add the AP to the network we need the Meraki serial number (SN). SN can be found on a label in the AP as shown in the following picture. 

![](/images/labelAP.jpeg)

For the LAB, (we are not allowed to bring equipment to the room :() so following are the SN.

```
| **Pod**       | **PID**       | **SN**|
| ------------- |:-------------:| ----------:|
| 1             | `CW9166I-A`   | `Q5AF-23LY-92QZ`       |
| 2             | `CW9164I-A`   | `Q5AD-SR9H-MNUM`       |
| 3             | `CW9166I-A`   | `Q5AF-SAX2-2S3G`       |
| 4             | `CW9166I-A`   | `Q5AF-9VQV-3Q2B`       |
| 5             | `CW9164I-A`   | `Q5AD-93SU-WKJ5`       |
| 6             | `CW9166I-A`   | `Q5AF-K93M-5QSE`       |
| 7             | `CW9166I-A`   | `Q5AF-XXW4-XB2R`       |
| 8             | `CW9164I-B`   | `Q5AD-VZZG-UUA2`       |
| 9             | `CW9164I-B`   | `Q5AD-YTKV-FRH3`       |
| 10            | `CW9162I-A`   | `Q5AB-XAEW-9YWS`       |
| 11            | `CW9162I-A`   | `Q5AB-XQ2T-WX3Y`       |
| 12            | `CW9164I-A`   | `Q5AD-7HE2-TFNS`       |
| 13            | `CW9166I-A`   | `Q5AF-MGZD-5XAL`       |
| 14            | `CW9166I-A`   | `Q5AF-24D6-GQMP`       |
| 15            | `CW9166I-A`   | `Q5AF-CRZ6-C2L9`       |

```
Click on **Add devices** and take the SN from the table above depending of the pod you are using. 

![](/images/createnetwork3.png)

Finally, click on **create the network**

![](/images/createnetwork4.png)

In the following page we can place the divice in a specific address , this will define the location for your AP in your network. 
Clock on **Place devices on the map** 

![](/images/adddevicemap1.png)

Select the AP and follow the steps in the image below

![](/images/adddevicemap2.png)

Click on **Enter address** and enter a valid address to position your AP.
(it can be anything, your company address, home, CL location, you pick ... ) 

![](/images/adddevicemap3.png)

Enter the address again on the input box in the map, to make sure the AP has been position correctly and "save the device placement"

![](/images/adddevicemap4.png)

Go to the **oganization** >> **overview**, you should see by now your network with the AP added and status green, meaning AP is online and ready to be configured. 

![](/images/justaddednw1.png)

Click on your **network name** and then on the **AP name**, at this moment is using AP mac address as name

![](/images/configAP1.png)

Give your AP a name. In this case we use: "Home-AP-rafenriq"

![](/images/configAP2.png)

Click on **BSSID detail** and you will see we  already have an SSID configured with name: "network" + "WiFi", this is expected as we use the default template, while creating the network. 

![](/images/configAP3.png)

### Modify your network information 

We can update information to the network just created. In this case let's set the right local time, as the organization was created selecting North America, we need to update this information. Make sure you are under your network before saving changes. Follow the image below.

![](/images/modifynw1.png)

![](/images/modifynw2.png)

Additionally we can configure SysLog and SNMP for network management. This values will be valid for all the devices you add to this network 
- SysLog IP address: 18.217.117.169
- Roles: Wireless event log

![](/images/modifynw3.png)

![](/images/modifynw4.png)

Finally save the changes

![](/images/modifynw5.png)


### Configuring Enterprise SSID

Navigate to **Wireless** >> **SSID**. Under **Unconfigured SSID 2** click **edit settings**

![](/images/ssid1.png)

Configure the following parameters:
- SSID name: give it a name, ex. "Corp rafenriq"
- Status: Enable 
- Security: Enterprise with "Meraki Cloud Authentications" 
- Encryption: WPA2
- Client IP and VLAN: "Meraki AP assigned (NAT mode)"

Once done **save the changes** on the right down corner and navigate back to **Wireless => SSID**
SSID(s) should look like as following: 

![](/images/ssid2.png)


### Configuring Guest SSID

Navigate to Wireless => SSID. Under **Unconfigured SSID 3** click **edit settings**

Configure the following parameters:
- SSID name: give it a name Ex. "Guest rafenriq"
- Status: Enable 
- Security: Open
- Splash Page: Sign-on with "Meraki Cloud authentication"
- For Advanced splash setting, let's use the following:
	- Captive portal strength: Chose type of traffic allowed before completing portal
	- Walled garden: Enable and add a public ip address, example: 1.1.1.1. Here we define IP addresses that can be allowed before going through the splash page, for example if portal is hosted in a 3rd party server, we need to allow this IP address so clients can reach to this portal
	- Self-registration: Display a form on the web page to allow client to create a user, users need to be Admin approved before they can actually work in the portal.  
	- Simultaneous logins: allow to use same user/password in different devices
	- Controller disconnection behavior: If AP is not reaching Meraki Dashboard, what is the expected behavior. 

![](/images/ssid3.png)

- Client IP and VLAN: "Meraki AP assigned (NAT mode)"

Once done save the changes on the right down corner and navigate back to Wireless => SSID
SSID should look like as following:

![](/images/ssid4.png)

#### Meraki Splash page

Unlike the very very simple portal page presented by 9800, show in image below:

![](/images/9800-portal.png)

Meraki has a very good user friendly interface on the dashboard to modify the default splash page to customize your own. 
All we need is a bit of creativity and HTML knownledge. 

In order to modify the splash page navigate to: Wireless >> Splash page on the menu >> 
Select the SSID we just created for guest clients. 
From there we have available 2 themes (moderm and fluid), which we can only modify colors as shown below. 

![](/images/splashpage1.png)

Click **Preview** to check how your new colour selection looks like. Feel free to play around with it. 

To further customize this, we will use one of these themes as a template, we can do the following: 

![](/images/splashpage2.png)

![](/images/splashpage3.png)

![](/images/splashpage4.png)

You will have a new tab on your browser to be able to modify the theme as needed. 
- Edit: will take us to the html code to be edited 
- Pop up: it is a preview of the changes made. 

![](/images/splashpage5.png)

In this case we are doing something very simple, we are just adding the following message to the page: "This message has been added for CL LAB LTREWN-2034" and we are changing the color for the font. 

Select "auth.html" and click Edit, add the following line to the html file and "Save" the file 
``` html
<h3>This message has been added for CL LAB LTREWN-2034</h3>
```

![](/images/splashpage8.png)

After, Let's select file "main.css" to configure the color as shown below and test the changes.

![](/images/splashpage9.png)

After you save the changes you should see them as following, You can play around addind more stuff if you want to. 
(the following link has the hex value for the colors you can use on the .css file [color codes](https://www.quackit.com/css/css_color_codes.cfm)) 

![](/images/splashpage10.png)

Click on **back to config** (righ side of the screen) and select your new custom theme, so users will be seeing this page. On this page you can still configure the following: 
-welcome message
-logo
-how frequent you want users to see the portal when they connect to the wireless network.

We have done the following changes to show the configuration 

![](/images/splashpage11.png)

**Save the changes**. Our final page looks like: 

![](/images/splashpage12.png)


### Radio Settings

Now let's modify the radio settings for our AP. Navigate to **Wireless** >> **Radio Settings**. From there you can see our AP is using the "Basic Indoor Profile", which is the default profile added when creating the network, but most likely in a real deployment we do not want this as every wireless deployment is different. You should see something similar as shown in the next image:

![](/images/radiosettings1.png)

Click on **RF profiles** >> **New Profile**

![](/images/radiosettings2.png)

The following screen will present some predefined profiles that can be taken for different type of deployments, in this case, we will create our own, click on **New Profile from Scratch**

![](/images/radiosettings3.png)

- Give your profile a name, in this example: lab-RF
- check **Enable operation on 6 GHz band**
- check **Enable band steering**
- For Flex Radio select 6GHz as band preference

You can follow the next image as reference. 

![](/images/radiosettings4.png)

Now, lets change to the **2.4 GHz** tab

- Decrease the transmit power
- Increase the minimum data rate to something above to 18Mbps
_Note: This will prevent for 802.11b client to connect to the network, of course this depends of the type of devices deployed in such site, but in this case we are going to prentet those clients are not a problem anymore _

![](/images/radiosettings5.png)

After, select **5 GHz** tab, here let's configure the following: 

- **Channel with** select **Manual** and configure **40Mhz**

![](/images/radiosettings6.png)

- Click on **RX - SOP**

![](/images/radiosettings7.png)

You will see the following warning, click **Proceed**

![](/images/radiosettings8.png)

- Enable **RX - SOP**
- Specify -78 dBm 

![](/images/radiosettings9.png)

**RX - SOP** is a very power feature that is mostly used in high density deployments, what we do is pretty much telling the AP that frames that are received with an RSSI below -78 dBm will just be ignore, therefore AP will not even try to decode them. 
The advantage of this is to create smaller cells with strong signal and warantee high data rates for clients. 

At last, select **6 GHz** tab

- **Channel with** select **Manual** and configure **160Mhz**
Here we can see one of the big advantages of using this band, which is allowing us to create bigger channels to transmit data. 

![](/images/radiosettings10.png)

Here we can see one of the big advantages of using this band, which is allowing us to create bigger channels to transmit data, due to the number of channels available in this band.  

- **Channel assigment method** click on **Change channels used by Autochannel..**

![](/images/radiosettings11.png)

Leave avaiable just one channel of 160Mhz (8 channels) so we force AP to take this one. Here an example, once finished, click on **Done**.

![](/images/radiosettings12.png)

_Note: In a real scenario we would like to have the PSC (preferred scanning channels) available. These are the channels that client will actively scan to disover the SSID, if this channels are not available it can take really long time for clients to discover the SSIDs._

_PSC channel list: 5, 21, 37, 53, 69, 85, 101, 117, 133, 149, 165, 181, 197, 213 and 229_

Finally **Save** the changes in the bottom of the page 

![](/images/radiosettings13.png)

You should be back to **Radio Setting** >> **RF profiles** and you should be able to see you new brand RF profile. 

![](/images/radiosettings14.png)

_Note: Remember that RF profiles are configured based on your site survey results, every wireless deployment is different, environmental condition changes, therefore RF propagation changes_

Go back to **Overview** >> select your AP using the check box >> click on **Edit Settings** >> then click on **Assign profile**

![](/images/radiosettings15.png)

Select your profile, in this case "lab-RF" and click on **Next**

![](/images/radiosettings16.png)

Check all three boxes to override values and click on **review changes**

![](/images/radiosettings17.png)

Review the changes and **Apply changes**

![](/images/radiosettings18.png)

It is possible that enabling radio on 6Ghz takes a bit of time but for now you should be able to see that the RF profiles has been apply correctly

![](/images/radiosettings19.png)

_Note: The CW9166 has three client-serving W-iFi radios capable of operating in 2.4 GHz, 5 GHz, and 6Hz frequencies. On the CW9166, the third Wi-Fi radio can be configured to operate either in the 5 GHz frequency band or 6 GHz frequency band. For 9162/9164 we have the 3 radios operating in different bands._

_The out-of-the-box setting of the CW9166 will have the second and third radio both operating in the 5 GHz frequency band (Dual 5 GHz mode)._

Give 2 minutes and then changes should be reflected 

![](/images/radiosettings20.png)

***
***

**> FYI - Channels on 6GHz band**

	> Even in domains where the new allocation is narrower—for example, in Europe with the ETSI domain
currently planning to allocate 500 MHz—the number of channels available to Wi-Fi doubles. This means that any place that had 40 MHz channels will soon be able to switch to 80 MHz channels.

	> In the US FCC domain, Wi-Fi 6E adds 1200 MHz of new spectrum, **creating 59** 20-MHz-wide channels, more than tripling the number of channels available.

**> FYI - Transmit power on 6GHz band**

	> People will want to take a 5GHz AP and do a 1:1 replacement with a 6GHz supported AP, this may seem reasonable, but there are some aspects to consider:

	> -As WiFi-6E uses a higher frequency, the propagation characteristics are different, the signal drops slightly faster in 6 than in 5GHz. The difference should be around 2 dBm on measurements over the same distance. Material absorption will be different as well.

	> -6GHz has different regulatory power constraints than 5GHz. Currently, most deployments will be using Low Power APs (for simplicity sake’s, let’s say 24dBm in FCC, 23 dBm in ETSI). This means that depending on the current network AP radio’s power levels,  using 6GHz may result in a slightly lower power output

***
***

At this point we might think that our _Corp_ and _Guest_ SSID are brodcasting on the 6Ghz band, but this is not true, WiFi 6E did not leave security out, so the security settings need to be configure to have an SSID brodcasted on the 6Ghz band: 

- WPA3: this enforces mandatory Protected Management Frames (PMF/802.11w)
- Opportunistic Key Encryption (OWE). This replaces the concept of “Open SSID”, and allows to have encryption across devices, without any authentication
- Simultaneous Authentication of Equals (SAE). This takes the role of PSK (also called “personal”) authentication methods but makes it resistant to offline password attacks, with improved cryptographic algorithms

So in order for us to configure a working SSID for 6Ghz lets create a new SSID. 

Navigate to **Wireless** >> **SSID** >> under **Unconfigured SSID 4** >> click on **Edit settings**

![](/images/ssid6g1.png)

Use the following parameters: 
- **SSID name**: you pick it, in this example Wlan6GHz
- **SSID status**: Enable
- Enable **Opportunistic Wireless Encryption (OWE)**
- You will notice that WPA3 encryption and 802.11w are enabled by default and values cannot be changed. 
    
![](/images/ssid6g2.png)
    
- **Splash page** select none
- Use **Meraki AP assigned (NAT mode)** under **Client IP and VLAN**
- **Save** the changes on the right down corner. 
    
Navigate back to **Wireless** >> **SSID** and your new SSID should look like as follow: 

![](/images/ssid6g3.png)

_Note: That's it!, all this looks very easy but in real world scenarios you must likely need transition scearios, for more information on that, look at the reference link on top of this guide to learn more about it._

### Troubleshoot Meraki AP 

#### AP join

Although Meraki does not provide as powerful tools as 9800 to troubleshoot AP join, as most of the information is kept on the cloud back-end and engaging support from Meraki is needed. It does provide basic connectivity test, you can play around with them if you like.

You can navigate to **Wireless** >> **Access Points** >> click on your AP name

![](/images/ts2.png)

Under **Tool** option we can perform  ping, traceroute, throughput test to AP. 

![](/images/ts3.png)

#### RF

The tools available to monitor health for clients and RF on the wireless networks on the other hand are very advanced. 

Meraki dashboard provides very powerful tool to monitor your RF enviroment. You can review this information for you access point using **Monitor** >> **RF spectrum**

-From this information, we can identify what is the channel utilization for each channel on both bands 2.4Ghz, 5Ghz and 6Ghz still not added but soon to come :)
-We can also indentify what other SSID are being brodcasted on the same location and how strong we can hear them. 

The real advantage of Meraki here is the ability to do real-time spectrum analysis of the enviroment while servin clients. 

![](/images/ts1.png)

_Note: while troubleshooting signals on the RF spectrum is not easy. On the reference page of this guide we leave you a link to most common signal pattern interfering in 2.4Ghz and 5Ghz_ 

#### Clients

Meraki dashboard offer many stats, graphs to monitor traffic for clients, health, problem, etc. 
As this LAB is not intended to be used with clients we prefer to leave you some link on the refernce part to have more information on this if needed. 

### Migration from Meraki to 9800 WLC 

First thing we need to do is disable messing from the AP, as this is a feature enable by default and with it we cannot move the AP back to the 9800 WLC. 

Navigate to **Network-wide** >> **General** 

![](/images/migrationback7.png)

Now disable meshing as show in the following picture

![](/images/migrationback5.png)

**Save** the changes on the right low corner. 

Navigate to **Wireless** >> **Access Points** >> click on your AP name

![](/images/migrationback1.png)

Click on **Edit** >> **Migrate to Cisco DNA Management Mode**

![](/images/migrationback2.png)

You will received a warning message, click on **Migrate 1 access point**. It will take few minutes for AP to reload. After that you should see the AP as disconnected from Meraki dasboard. 

![](/images/migrationback6.png)
